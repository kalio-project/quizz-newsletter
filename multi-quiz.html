<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Quiz ‚ö°</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-blue-600 min-h-screen p-6 flex flex-col items-center">
    <nav class="w-full max-w-2xl mb-8">
        <a href="index.html" class="text-white font-bold bg-white/20 px-6 py-2 rounded-full hover:bg-white/30 transition">‚Üê Retour</a>
    </nav>

    <div id="setup" class="bg-white p-10 rounded-[50px] shadow-2xl max-w-2xl w-full">
        <h1 class="text-5xl font-black mb-10 text-slate-900 tracking-tighter">Super Quiz ‚ö°</h1>
        
        <div class="mb-10">
            <label class="block font-black text-slate-400 uppercase text-xs mb-6 tracking-widest">1. Choisir des th√®mes</label>
            <div id="theme-selector" class="flex flex-wrap gap-3">
                </div>
        </div>

        <div class="mb-12">
            <label class="block font-black text-slate-400 uppercase text-xs mb-6 tracking-widest">2. Volume de questions</label>
            <input type="range" id="qty" min="5" max="50" step="5" value="15" class="w-full h-4 bg-slate-100 rounded-full appearance-none cursor-pointer accent-blue-600">
            <div id="qty-val" class="text-center font-black text-4xl mt-6 text-blue-600">15</div>
        </div>

        <button onclick="startQuiz()" class="w-full bg-slate-900 text-white py-7 rounded-[30px] font-black text-2xl hover:bg-black transition-all transform hover:scale-[1.03] shadow-xl">
            C'EST PARTI !
        </button>
    </div>

    <div id="game" class="hidden w-full max-w-2xl bg-slate-900 text-white rounded-[50px] p-10 md:p-14 shadow-2xl">
        <div id="q-area">
             <div id="progression" class="text-slate-500 font-bold mb-6 bg-white/5 inline-block px-4 py-1 rounded-full text-xs uppercase tracking-widest">Question 1/15</div>
             <div id="q-category" class="text-blue-400 text-xs font-black uppercase mb-3">Th√®me</div>
             <h2 id="q-text" class="text-2xl md:text-3xl font-bold mb-10 italic leading-tight">...</h2>
             <div id="options" class="grid gap-4"></div>
             <div id="feedback" class="hidden mt-10 p-8 rounded-3xl bg-white/10 border border-white/20"></div>
             <button id="next-btn" class="hidden mt-10 w-full bg-blue-600 py-5 rounded-3xl font-black text-xl shadow-lg">CONTINUER</button>
        </div>
        <div id="result" class="hidden text-center py-10">
            <h2 class="text-8xl mb-6">üî•</h2>
            <h3 class="text-4xl font-black">Score Final</h3>
            <p id="final-score" class="text-5xl mt-6 font-black text-blue-400"></p>
            <button onclick="location.reload()" class="mt-14 bg-white text-slate-900 px-12 py-5 rounded-full font-black text-xl">RECOMMENCER</button>
        </div>
    </div>

    <script>
        let pool = [];
        let selectedQuestions = [];
        let currentIdx = 0, score = 0;
        let selectedThemes = new Set();

        document.getElementById('qty').oninput = (e) => document.getElementById('qty-val').textContent = e.target.value;

        async function init() {
            const res = await fetch('manifest.json');
            const manifest = await res.json();
            for(let item of manifest) {
                const qData = await (await fetch(item.file)).json();
                qData.questions.forEach(q => pool.push(q));
            }
            const themes = [...new Set(pool.map(q => q.theme))].filter(t => t).sort();
            const container = document.getElementById('theme-selector');
            themes.forEach(t => {
                const b = document.createElement('button');
                b.className = "px-5 py-3 rounded-2xl border-2 border-slate-100 font-black text-sm uppercase tracking-tight transition-all";
                b.textContent = t;
                b.onclick = () => {
                    if(selectedThemes.has(t)) {
                        selectedThemes.delete(t);
                        b.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                    } else {
                        selectedThemes.add(t);
                        b.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                    }
                };
                container.appendChild(b);
            });
        }

        function startQuiz() {
            const qty = parseInt(document.getElementById('qty').value);
            let filtered = selectedThemes.size > 0 ? pool.filter(q => selectedThemes.has(q.theme)) : pool;
            if(filtered.length === 0) return alert("Pas de questions pour ces th√®mes !");

            selectedQuestions = filtered.sort(() => 0.5 - Math.random()).slice(0, qty);
            document.getElementById('setup').classList.add('hidden');
            document.getElementById('game').classList.remove('hidden');
            renderQ();
        }

        function renderQ() {
            const q = selectedQuestions[currentIdx];
            document.getElementById('progression').textContent = `QUESTION ${currentIdx+1} / ${selectedQuestions.length}`;
            document.getElementById('q-category').textContent = q.theme;
            document.getElementById('q-text').textContent = q.q;
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            
            const optDiv = document.getElementById('options');
            optDiv.innerHTML = '';
            q.options.forEach((o, i) => {
                const b = document.createElement('button');
                b.className = "text-left p-6 rounded-2xl border-2 border-white/5 bg-white/5 font-bold hover:bg-white/10 transition-all";
                b.textContent = o;
                b.onclick = () => {
                    const allB = optDiv.querySelectorAll('button');
                    allB.forEach(btn => btn.disabled = true);
                    document.getElementById('feedback').classList.remove('hidden');
                    if(i === q.correct) {
                        score++;
                        b.classList.add('bg-green-600', 'border-green-600');
                        document.getElementById('feedback').innerHTML = `<b class="text-green-400">BIEN JOU√â</b><br>${q.explication}`;
                    } else {
                        b.classList.add('bg-red-600', 'border-red-600');
                        allB[q.correct].classList.add('border-green-600', 'text-green-400');
                        document.getElementById('feedback').innerHTML = `<b class="text-red-400">ERREUR</b><br>${q.explication}`;
                    }
                    document.getElementById('next-btn').classList.remove('hidden');
                };
                optDiv.appendChild(b);
            });
        }

        document.getElementById('next-btn').onclick = () => {
            currentIdx++;
            if(currentIdx < selectedQuestions.length) renderQ();
            else {
                document.getElementById('q-area').classList.add('hidden');
                document.getElementById('result').classList.remove('hidden');
                document.getElementById('final-score').textContent = `${score} / ${selectedQuestions.length}`;
            }
        };
        init();
    </script>
</body>
</html>
