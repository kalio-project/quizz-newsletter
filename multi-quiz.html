<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Quiz - ActuQuiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .theme-checkbox:checked + label { background-color: #2563eb; color: white; border-color: #2563eb; }
    </style>
</head>
<body class="bg-slate-50 p-6">

    <div id="setup-screen" class="max-w-2xl mx-auto mt-10 bg-white p-10 rounded-3xl shadow-xl">
        <h1 class="text-4xl font-black text-slate-900 mb-2">Super Quiz ‚ö°</h1>
        <p class="text-slate-500 mb-10">Personnalisez votre entra√Ænement sur toutes les archives.</p>

        <label class="block text-sm font-black uppercase tracking-widest text-slate-400 mb-4">1. Choisissez vos th√®mes</label>
        <div id="theme-list" class="flex flex-wrap gap-2 mb-10">
            </div>

        <label class="block text-sm font-black uppercase tracking-widest text-slate-400 mb-4">2. Nombre de questions : <span id="count-val" class="text-blue-600">15</span></label>
        <input type="range" id="q-range" min="5" max="30" step="5" value="15" 
               class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600 mb-12"
               oninput="document.getElementById('count-val').innerText = this.value">

        <button onclick="startSuperQuiz()" class="w-full bg-blue-600 text-white py-5 rounded-2xl font-black text-xl shadow-lg shadow-blue-200 hover:scale-[1.02] transition">
            G√©n√©rer mon Quiz sur mesure
        </button>
        <p class="text-center mt-6"><a href="index.html" class="text-slate-400 font-bold text-sm">Retour</a></p>
    </div>

    <div id="game-screen" class="max-w-2xl mx-auto mt-10 hidden">
        <div class="bg-white p-8 rounded-3xl shadow-xl">
            <div class="flex justify-between items-center mb-8">
                <span id="game-cat" class="bg-blue-600 text-white text-[10px] font-black px-3 py-1 rounded-full uppercase">CAT√âGORIE</span>
                <span id="game-counter" class="text-slate-400 font-bold text-sm">1 / 15</span>
            </div>
            <h2 id="game-q-text" class="text-2xl font-black text-slate-900 mb-8 leading-tight"></h2>
            <div id="game-options" class="space-y-3"></div>
            <div id="game-expl" class="hidden mt-6 p-5 bg-slate-100 rounded-2xl text-sm italic"></div>
            <button id="game-next" onclick="nextSuperQ()" class="hidden w-full mt-8 bg-slate-900 text-white py-4 rounded-2xl font-bold transition">Suivant</button>
        </div>
    </div>

    <script>
        let pool = [];
        let selection = [];
        let currentIdx = 0;
        let score = 0;

        async function init() {
            const res = await fetch('manifest.json');
            const manifest = await res.json();
            const themesFound = new Set();

            for (let item of manifest) {
                const r = await fetch(item.file);
                const d = await r.json();
                d.questions.forEach(q => {
                    pool.push(q);
                    if (q.categorie) themesFound.add(q.categorie);
                });
            }

            const themeDiv = document.getElementById('theme-list');
            [...themesFound].sort().forEach(t => {
                themeDiv.innerHTML += `
                    <div class="relative">
                        <input type="checkbox" id="t-${t}" value="${t}" class="theme-checkbox hidden" checked>
                        <label for="t-${t}" class="block px-4 py-2 bg-white border border-slate-200 rounded-xl text-sm font-bold cursor-pointer hover:bg-slate-50 transition">
                            ${t}
                        </label>
                    </div>
                `;
            });
        }

        function startSuperQuiz() {
            const activeThemes = Array.from(document.querySelectorAll('.theme-checkbox:checked')).map(i => i.value);
            const count = parseInt(document.getElementById('q-range').value);

            selection = pool.filter(q => activeThemes.includes(q.categorie));
            selection.sort(() => Math.random() - 0.5);
            selection = selection.slice(0, count);

            if (selection.length === 0) return alert("Aucune question trouv√©e pour ces th√®mes.");

            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            renderSuperQ();
        }

        function renderSuperQ() {
            const q = selection[currentIdx];
            document.getElementById('game-counter').innerText = `${currentIdx + 1} / ${selection.length}`;
            document.getElementById('game-cat').innerText = q.categorie;
            document.getElementById('game-q-text').innerText = q.q;
            document.getElementById('game-expl').classList.add('hidden');
            document.getElementById('game-next').classList.add('hidden');
            
            const optDiv = document.getElementById('game-options');
            optDiv.innerHTML = "";
            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "w-full p-5 bg-white border-2 border-slate-100 rounded-2xl text-left font-bold hover:border-blue-200 transition";
                btn.innerText = opt;
                btn.onclick = () => {
                    const btns = optDiv.querySelectorAll('button');
                    btns.forEach(b => b.disabled = true);
                    document.getElementById('game-expl').innerText = q.explication;
                    document.getElementById('game-expl').classList.remove('hidden');
                    if(i === q.correct) { btn.classList.add('bg-green-50', 'border-green-500'); score++; }
                    else { btn.classList.add('bg-red-50', 'border-red-500'); btns[q.correct].classList.add('bg-green-50', 'border-green-500'); }
                    document.getElementById('game-next').classList.remove('hidden');
                };
                optDiv.appendChild(btn);
            });
        }

        function nextSuperQ() {
            currentIdx++;
            if (currentIdx < selection.length) renderSuperQ();
            else {
                document.getElementById('game-screen').innerHTML = `
                    <div class="bg-white p-10 rounded-3xl shadow-xl text-center">
                        <div class="text-5xl mb-6">üèÜ</div>
                        <h2 class="text-3xl font-black mb-2">Score Final</h2>
                        <div class="text-6xl font-black text-blue-600 mb-8">${score} / ${selection.length}</div>
                        <button onclick="location.reload()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-bold">Recommencer</button>
                    </div>`;
            }
        }

        init();
    </script>
</body>
</html>
