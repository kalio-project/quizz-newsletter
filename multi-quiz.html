<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Quiz - Hugo Décrypte</title>
    <style>
        :root { --navy: #151a2e; --red: #e63946; }
        body { font-family: 'Inter', sans-serif; background: var(--navy); color: white; margin: 0; padding: 20px; }
        
        .wrapper { max-width: 800px; margin: 0 auto; }
        .header-box { text-align: center; padding: 40px 0; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 40px; }
        
        .q-box { background: white; color: #333; padding: 30px; border-radius: 15px; margin-bottom: 30px; position: relative; }
        .source-tag { position: absolute; top: 10px; right: 20px; font-size: 0.7em; color: #999; text-transform: uppercase; }
        
        button { 
            display: block; width: 100%; text-align: left; padding: 14px; margin: 10px 0; 
            border: 2px solid #f0f0f0; border-radius: 10px; background: white; cursor: pointer; font-weight: 500;
        }
        button:hover { background: #f9f9f9; border-color: var(--navy); }
        
        .expl { display: none; margin-top: 15px; padding: 15px; border-radius: 8px; background: #eef6ff; color: var(--navy); border-left: 5px solid var(--red); }
        
        .progress-bar { position: fixed; top: 0; left: 0; height: 5px; background: var(--red); width: 0%; transition: 0.3s; }
    </style>
</head>
<body>
    <div class="progress-bar" id="progress"></div>

    <div class="wrapper">
        <div class="header-box">
            <h1 style="letter-spacing: 3px;">SUPER QUIZ</h1>
            <p>50 questions tirées de vos dernières lectures</p>
        </div>

        <div id="loader">Chargement des questions...</div>
    </div>

    <script>
        async function start() {
            const resManifest = await fetch('manifest.json');
            const manifest = await resManifest.json();
            let pool = [];

            // Récupérer toutes les questions
            for (let item of manifest) {
                const r = await fetch(item.file);
                const d = await r.json();
                const qs = d.questions.map(q => ({...q, source: d.titre}));
                pool = pool.concat(qs);
            }

            // Mélanger et limiter à 50
            pool.sort(() => Math.random() - 0.5);
            const selection = pool.slice(0, 50);

            const loader = document.getElementById('loader');
            loader.innerHTML = "";

            selection.forEach((q, i) => {
                const div = document.createElement('div');
                div.className = 'q-box';
                div.innerHTML = `
                    <span class="source-tag">${q.source}</span>
                    <p><strong>${i+1}. ${q.q}</strong></p>
                    ${q.options.map((o, idx) => `<button onclick="show(${i}, ${idx}, ${q.correct})">${o}</button>`).join('')}
                    <div id="ex-${i}" class="expl">${q.explication}</div>
                `;
                loader.appendChild(div);
            });
        }

        let answered = 0;
        function show(qIdx, choice, correct) {
            const ex = document.getElementById(`ex-${qIdx}`);
            if(ex.style.display !== "block") {
                ex.style.display = "block";
                answered++;
                document.getElementById('progress').style.width = (answered / 50 * 100) + "%";
            }
        }

        start();
    </script>
</body>
</html>
