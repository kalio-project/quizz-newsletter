<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ActuQuiz - Lecture & Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background: #fff; color: #1e293b; }

        /* NETTOYAGE CSS : On masque les r√©sidus techniques de Kessel */
        #hugo-content svg, 
        #hugo-content .preheader, 
        #hugo-content center,
        #hugo-content .footer { 
            display: none !important; 
        }

        /* Style de l'article pour une lecture agr√©able */
        #hugo-content { line-height: 1.8; font-size: 1.1rem; }
        #hugo-content img { 
            max-width: 100%; 
            height: auto; 
            border-radius: 1.5rem; 
            margin: 2rem 0; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        #hugo-content p { margin-bottom: 1.5rem; }
        #hugo-content a { color: #2563eb; text-decoration: underline; font-weight: 600; }
        
        /* Styles des boutons de quiz */
        .option-btn { transition: all 0.2s; border: 2px solid #f1f5f9; }
        .option-btn:hover:not(:disabled) { border-color: #cbd5e1; background-color: #f8fafc; }
        .option-btn.correct { border-color: #22c55e !important; background-color: #f0fdf4 !important; color: #166534 !important; }
        .option-btn.wrong { border-color: #ef4444 !important; background-color: #fef2f2 !important; color: #991b1b !important; }
        
        .progress-bar { transition: width 0.4s ease-out; }
    </style>
</head>
<body class="bg-white">

    <nav class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-slate-100 p-4">
        <div class="max-w-3xl mx-auto flex justify-between items-center">
            <a href="index.html" class="text-blue-600 font-black italic tracking-tighter text-xl uppercase">ActuQuiz.</a>
            <div id="nav-counter" class="hidden text-[10px] font-black bg-slate-100 px-3 py-1 rounded-full text-slate-500 uppercase tracking-widest">
                Question 01
            </div>
        </div>
    </nav>

    <main class="max-w-3xl mx-auto p-4 md:p-8">
        
        <div class="mb-10">
            <img id="main-cover" src="" class="w-full h-64 md:h-[450px] object-cover rounded-[2.5rem] shadow-2xl bg-slate-100 transition-opacity duration-500 opacity-0">
        </div>

        <article id="hugo-content" class="prose prose-slate max-w-none mb-16 border-b border-slate-100 pb-16">
            <div class="flex flex-col gap-4">
                <div class="h-4 w-3/4 bg-slate-100 animate-pulse rounded"></div>
                <div class="h-4 w-full bg-slate-100 animate-pulse rounded"></div>
                <div class="h-4 w-5/6 bg-slate-100 animate-pulse rounded"></div>
            </div>
        </article>

        <section id="quiz-section" class="mb-32">
            <div class="text-center mb-10">
                <span class="bg-blue-600 text-white px-4 py-1 rounded-full text-[10px] font-black uppercase tracking-[0.2em]">Le Quiz de l'√©dition</span>
            </div>

            <div id="quiz-card" class="bg-slate-50 rounded-[3rem] p-6 md:p-12 border border-slate-100 shadow-xl relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-2 bg-slate-200">
                    <div id="progression" class="progress-bar h-full bg-blue-600 w-0"></div>
                </div>

                <div id="game-zone">
                    <div class="flex justify-between items-center mb-8">
                        <span id="q-category" class="text-[10px] font-black px-3 py-1 bg-white border border-slate-200 text-blue-600 rounded-lg uppercase tracking-widest shadow-sm">Chargement...</span>
                        <span id="q-counter-text" class="text-slate-400 font-bold text-[10px] tracking-widest uppercase">01 / 10</span>
                    </div>

                    <div id="q-display-zone">
                        <h2 id="q-text" class="text-xl md:text-3xl font-black text-slate-900 leading-tight mb-10"></h2>
                        
                        <div id="options-grid" class="grid grid-cols-1 gap-3">
                            </div>

                        <div id="explanation-box" class="hidden mt-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                            <div class="p-6 bg-white rounded-[2rem] border-2 border-blue-50 text-slate-700 shadow-sm mb-6">
                                <p id="expl-text" class="leading-relaxed"></p>
                            </div>
                            <button onclick="nextQuestion()" class="w-full bg-blue-600 hover:bg-slate-900 text-white py-5 rounded-2xl font-black text-xs uppercase tracking-[0.2em] transition-colors shadow-lg shadow-blue-100">
                                Question Suivante ‚Üí
                            </button>
                        </div>
                    </div>
                </div>

                <div id="end-screen" class="hidden text-center py-10">
                    <div class="mb-6 text-5xl">üèÜ</div>
                    <h2 class="text-3xl font-black text-slate-900 mb-2 uppercase italic">Termin√© !</h2>
                    <p class="text-slate-500 font-medium mb-8 uppercase text-[10px] tracking-widest">Votre score final</p>
                    <div id="final-score" class="text-8xl font-black text-blue-600 mb-12 italic">0 / 0</div>
                    <a href="index.html" class="inline-block bg-slate-900 text-white px-12 py-5 rounded-2xl font-black uppercase text-xs tracking-[0.2em] hover:scale-105 transition-transform">
                        Retour √† l'accueil
                    </a>
                </div>
            </div>
        </section>
    </main>

    <script>
        let questions = [];
        let currentIdx = 0;
        let score = 0;

        async function loadQuizData() {
            const params = new URLSearchParams(window.location.search);
            const filePath = params.get('file');
            if(!filePath) return window.location.href = 'index.html';

            try {
                const res = await fetch(filePath);
                const data = await res.json();
                
                // 1. Affichage Image
                const img = document.getElementById('main-cover');
                img.src = data.image || '';
                img.onload = () => img.classList.replace('opacity-0', 'opacity-100');
                
                // 2. NETTOYAGE DU CONTENU (La coupe demand√©e)
                let rawHtml = data.html_affichage;
                const phraseCouperet = "Vous avez aim√© cette newsletter ?";
                
                if (rawHtml.includes(phraseCouperet)) {
                    // On coupe tout ce qui suit la phrase
                    rawHtml = rawHtml.split(phraseCouperet)[0];
                }
                document.getElementById('hugo-content').innerHTML = rawHtml;
                
                // 3. Initialisation Quiz
                questions = data.questions || [];
                renderQuestion();
                document.getElementById('nav-counter').classList.remove('hidden');

            } catch (err) {
                document.getElementById('hugo-content').innerHTML = "<p class='text-red-500 font-bold'>Erreur : Impossible de charger le contenu.</p>";
            }
        }

        function renderQuestion() {
            const q = questions[currentIdx];
            if(!q) return;

            // Mise √† jour UI
            document.getElementById('q-counter-text').innerText = `${String(currentIdx + 1).padStart(2, '0')} / ${questions.length}`;
            document.getElementById('nav-counter').innerText = `Question ${currentIdx + 1}`;
            document.getElementById('q-category').innerText = q.categorie || "INFO";
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('explanation-box').classList.add('hidden');
            
            // Progression
            const percent = ((currentIdx) / questions.length) * 100;
            document.getElementById('progression').style.width = percent + "%";
            
            const grid = document.getElementById('options-grid');
            grid.innerHTML = "";
            
            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full p-5 md:p-6 rounded-[1.5rem] text-left font-bold text-slate-700 bg-white shadow-sm text-sm md:text-base";
                btn.innerText = opt;
                
                btn.onclick = () => {
                    const btns = grid.querySelectorAll('button');
                    btns.forEach(b => b.disabled = true);
                    
                    document.getElementById('expl-text').innerHTML = `<span class="font-black uppercase tracking-widest text-[10px] ${i === q.correct ? 'text-green-600' : 'text-red-600'}">${i === q.correct ? '‚úÖ Correct' : '‚ùå Incorrect'}</span><br><br>${q.explication}`;
                    document.getElementById('explanation-box').classList.remove('hidden');
                    
                    if(i === q.correct) {
                        btn.classList.add('correct');
                        score++;
                    } else {
                        btn.classList.add('wrong');
                        btns[q.correct].classList.add('correct');
                    }
                    
                    // On scroll doucement vers l'explication sur mobile
                    setTimeout(() => {
                        document.getElementById('explanation-box').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 100);
                };
                grid.appendChild(btn);
            });
        }

        function nextQuestion() {
            currentIdx++;
            if (currentIdx < questions.length) {
                renderQuestion();
                // Remonter au d√©but de la carte quiz
                document.getElementById('quiz-card').scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                document.getElementById('progression').style.width = "100%";
                document.getElementById('game-zone').classList.add('hidden');
                document.getElementById('end-screen').classList.remove('hidden');
                document.getElementById('final-score').innerText = `${score} / ${questions.length}`;
                document.getElementById('nav-counter').innerText = `Termin√© !`;
            }
        }

        // D√©marrage
        loadQuizData();
    </script>
</body>
</html>
