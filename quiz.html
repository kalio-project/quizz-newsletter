<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecture & Quiz - ActuQuiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .option-btn { transition: all 0.2s; border: 2px solid #e2e8f0; }
        .option-btn.correct { border-color: #22c55e; background-color: #f0fdf4; color: #166534; }
        .option-btn.wrong { border-color: #ef4444; background-color: #fef2f2; color: #991b1b; }
    </style>
</head>
<body class="bg-white">

    <nav class="sticky top-0 bg-white/80 backdrop-blur-md border-b z-50 p-4">
        <div class="max-w-3xl mx-auto flex justify-between items-center">
            <a href="index.html" class="text-blue-600 font-bold">‚Üê Retour</a>
            <span id="progress-top" class="text-xs font-black text-slate-400 uppercase tracking-widest">Lecture en cours</span>
        </div>
    </nav>

    <main class="max-w-3xl mx-auto p-6 pb-32">
        <article id="hugo-content" class="prose prose-slate max-w-none mb-20">
            <p class="text-center text-slate-400 italic">Chargement de l'article...</p>
        </article>

        <section id="quiz-block" class="bg-slate-50 rounded-3xl p-8 border border-slate-100 shadow-xl shadow-slate-200/50">
            <div id="quiz-intro-img" class="mb-6 rounded-2xl overflow-hidden hidden">
                <img src="" id="q-header-img" class="w-full h-48 object-cover">
            </div>

            <div id="q-container">
                <div class="flex justify-between items-center mb-6">
                    <span id="q-category" class="bg-blue-100 text-blue-700 text-[10px] font-black px-3 py-1 rounded-full uppercase">CAT√âGORIE</span>
                    <span id="q-counter" class="text-slate-400 text-xs font-bold">Question 1/10</span>
                </div>
                
                <h2 id="q-text" class="text-2xl font-black text-slate-900 mb-8 leading-tight"></h2>
                
                <div id="options-grid" class="space-y-3"></div>

                <div id="explanation-box" class="hidden mt-6 p-5 bg-blue-50 rounded-2xl border border-blue-100 text-blue-900 text-sm leading-relaxed">
                </div>

                <button id="next-btn" onclick="nextQuestion()" class="hidden w-full mt-8 bg-slate-900 text-white py-4 rounded-2xl font-bold shadow-lg hover:bg-blue-600 transition">
                    Question suivante
                </button>
            </div>

            <div id="end-screen" class="hidden text-center py-10">
                <div class="text-6xl mb-4">üéä</div>
                <h2 class="text-3xl font-black text-slate-900 mb-2">F√©licitations !</h2>
                <p class="text-slate-500 mb-8">Vous avez termin√© le test de cette √©dition.</p>
                <div class="text-5xl font-black text-blue-600 mb-10" id="final-score">0 / 0</div>
                <a href="index.html" class="inline-block bg-slate-900 text-white px-10 py-4 rounded-2xl font-bold">Retour √† l'accueil</a>
            </div>
        </section>
    </main>

    <script>
        let questions = [];
        let currentIdx = 0;
        let score = 0;
        let imageUrl = "";

        const params = new URLSearchParams(window.location.search);
        const file = params.get('file');

        fetch(file).then(r => r.json()).then(data => {
            // Nettoyage HTML
            let cleanHtml = data.html_affichage || data.contenu_html;
            cleanHtml = cleanHtml.replace(/.*Ouvrir dans le navigateur.*/i, "");
            const splitKey = "Vous avez aim√© cette newsletter ?";
            if (cleanHtml.includes(splitKey)) cleanHtml = cleanHtml.split(splitKey)[0];
            
            document.getElementById('hugo-content').innerHTML = cleanHtml;
            
            // R√©cup√©ration de l'image pour le header du quiz
            const firstImg = document.querySelector('#hugo-content img');
            if (firstImg) {
                document.getElementById('quiz-intro-img').classList.remove('hidden');
                document.getElementById('q-header-img').src = firstImg.src;
            }

            questions = data.questions;
            renderQuestion();
        });

        function renderQuestion() {
            const q = questions[currentIdx];
            document.getElementById('q-counter').innerText = `Question ${currentIdx + 1} / ${questions.length}`;
            document.getElementById('q-category').innerText = q.categorie || "Actualit√©";
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('explanation-box').classList.add('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            
            const grid = document.getElementById('options-grid');
            grid.innerHTML = "";
            
            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full p-5 rounded-2xl text-left font-bold text-slate-700 bg-white hover:border-slate-400";
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(i, q.correct, btn);
                grid.appendChild(btn);
            });
        }

        function checkAnswer(idx, correct, btn) {
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.disabled = true);

            const explBox = document.getElementById('explanation-box');
            explBox.innerHTML = `<strong>L'explication :</strong><br>${questions[currentIdx].explication}`;
            explBox.classList.remove('hidden');

            if (idx === correct) {
                btn.classList.add('correct');
                score++;
            } else {
                btn.classList.add('wrong');
                btns[correct].classList.add('correct');
            }
            document.getElementById('next-btn').classList.remove('hidden');
        }

        function nextQuestion() {
            currentIdx++;
            if (currentIdx < questions.length) {
                renderQuestion();
            } else {
                document.getElementById('q-container').classList.add('hidden');
                document.getElementById('quiz-intro-img').classList.add('hidden');
                document.getElementById('end-screen').classList.remove('hidden');
                document.getElementById('final-score').innerText = `${score} / ${questions.length}`;
            }
        }
    </script>
</body>
</html><!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecture & Test - Hugo D√©crypte</title>
    <style>
        :root { --hugo-red: #e63946; --navy: #151a2e; --green: #2a9d8f; }
        body { font-family: -apple-system, system-ui, sans-serif; margin: 0; background: #fff; color: #1a1a1a; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Nav */
        .nav-bar { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: white; }
        .btn-back { text-decoration: none; color: var(--navy); font-weight: bold; }

        /* Layout */
        .main-layout { display: flex; flex: 1; overflow: hidden; }
        
        /* Colonne Article */
        .article-col { flex: 1; overflow-y: auto; padding: 40px; border-right: 1px solid #eee; }
        #hugo-view { max-width: 700px; margin: 0 auto; line-height: 1.7; font-size: 17px; }
        #hugo-view img { max-width: 100%; border-radius: 12px; }

        /* Colonne Quiz Fixe (Sans scroll) */
        .quiz-col { width: 400px; padding: 40px; background: #f8f9fa; display: flex; flex-direction: column; justify-content: center; }
        .quiz-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); position: relative; min-height: 400px; display: flex; flex-direction: column; }
        
        .progress-text { font-size: 12px; font-weight: bold; color: #999; text-transform: uppercase; margin-bottom: 10px; }
        .question-text { font-size: 18px; font-weight: 700; margin-bottom: 20px; color: var(--navy); }
        
        .option { display: block; width: 100%; padding: 15px; margin: 8px 0; border: 2px solid #eee; border-radius: 10px; background: white; text-align: left; cursor: pointer; font-size: 15px; transition: 0.2s; }
        .option.correct { border-color: var(--green); background: #e6f4ea; color: #155724; }
        .option.wrong { border-color: var(--hugo-red); background: #fce8e8; color: #721c24; }

        .explanation { margin-top: 20px; padding: 15px; background: #f0f4f8; border-radius: 8px; font-size: 14px; line-height: 1.5; display: none; }
        .btn-next { margin-top: auto; padding: 12px; background: var(--navy); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; display: none; width: 100%; }

        /* √âcran de fin */
        #final-screen { text-align: center; display: none; flex-direction: column; justify-content: center; align-items: center; height: 100%; }
        .score-circle { width: 100px; height: 100px; border-radius: 50%; border: 5px solid var(--hugo-red); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div class="nav-bar">
        <a href="index.html" class="btn-back">‚Üê Retour aux articles</a>
        <div id="step-counter">Question 1 / 10</div>
    </div>

    <div class="main-layout">
        <div class="article-col">
            <div id="hugo-view">Chargement de l'article...</div>
        </div>

        <div class="quiz-col">
            <div id="quiz-container" class="quiz-card">
                <div class="progress-text">V√©rification des acquis</div>
                <div id="question-area">
                    <p id="q-text" class="question-text"></p>
                    <div id="options-area"></div>
                    <div id="q-expl" class="explanation"></div>
                </div>
                <button id="next-btn" class="btn-next" onclick="nextQuestion()">Question suivante</button>
            </div>

            <div id="final-screen">
                <div class="score-circle" id="final-score">0/10</div>
                <h2>F√©licitations ! üéä</h2>
                <p>Vous avez termin√© le test de lecture.</p>
                <a href="index.html" style="color: var(--hugo-red); font-weight: bold; text-decoration: none;">Retourner √† l'accueil</a>
            </div>
        </div>
    </div>

    <script>
        let currentQ = 0;
        let score = 0;
        let quizData = [];

        const file = new URLSearchParams(window.location.search).get('file');

        fetch(file).then(r => r.json()).then(data => {
            // NETTOYAGE HTML d'Hugo
            let cleanHtml = data.html_affichage;
            // Retire "Ouvrir dans le navigateur"
            cleanHtml = cleanHtml.replace(/.*Ouvrir dans le navigateur.*/i, "");
            // Coupe tout apr√®s "Vous avez aim√© cette newsletter ?"
            const splitKey = "Vous avez aim√© cette newsletter ?";
            if (cleanHtml.includes(splitKey)) {
                cleanHtml = cleanHtml.split(splitKey)[0];
            }
            document.getElementById('hugo-view').innerHTML = cleanHtml;
            
            quizData = data.questions;
            showQuestion();
        });

        function showQuestion() {
            const q = quizData[currentQ];
            document.getElementById('step-counter').innerText = `Question ${currentQ + 1} / ${quizData.length}`;
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('q-expl').style.display = "none";
            document.getElementById('next-btn').style.display = "none";
            
            const optionsArea = document.getElementById('options-area');
            optionsArea.innerHTML = "";
            
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'option';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(idx, q.correct, btn);
                optionsArea.appendChild(btn);
            });
        }

        function checkAnswer(choice, correct, btn) {
            const allButtons = document.querySelectorAll('.option');
            allButtons.forEach(b => b.disabled = true); // D√©sactive les autres clics

            const expl = document.getElementById('q-expl');
            expl.innerText = quizData[currentQ].explication;
            expl.style.display = "block";

            if (choice === correct) {
                btn.classList.add('correct');
                score++;
            } else {
                btn.classList.add('wrong');
                allButtons[correct].classList.add('correct');
            }

            document.getElementById('next-btn').style.display = "block";
        }

        function nextQuestion() {
            currentQ++;
            if (currentQ < quizData.length) {
                showQuestion();
            } else {
                document.getElementById('quiz-container').style.display = "none";
                document.getElementById('final-screen').style.display = "flex";
                document.getElementById('final-score').innerText = `${score} / ${quizData.length}`;
            }
        }
    </script>
</body>
</html>
