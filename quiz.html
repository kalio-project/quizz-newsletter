<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz HugoDÃ©crypte</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; line-height: 1.7; max-width: 800px; margin: 0 auto; padding: 40px 20px; background: #f8fafc; }
        article { font-size: 1.1em; color: #334155; margin-bottom: 100px; }
        article img { max-width: 100%; border-radius: 20px; margin: 20px 0; }
        .quiz-box { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top-left-radius: 30px; border-top-right-radius: 30px; box-shadow: 0 -20px 40px rgba(0,0,0,0.1); padding: 30px; transform: translateY(100%); transition: transform 0.5s ease; z-index: 1000; }
        .quiz-box.active { transform: translateY(0); }
        .question { font-size: 1.3em; font-weight: 600; margin-bottom: 20px; }
        .options { display: flex; flex-direction: column; gap: 15px; }
        .option { padding: 15px; background: #f1f5f9; border-radius: 15px; cursor: pointer; transition: all 0.3s; }
        .option:hover { background: #e2e8f0; }
        .option.correct { background: #10b981; color: white; }
        .option.wrong { background: #ef4444; color: white; }
        .explanation { margin-top: 15px; padding: 15px; background: #dbeafe; border-radius: 15px; display: none; }
        .next-btn { background: #3b82f6; color: white; border: none; padding: 15px 30px; border-radius: 50px; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>
    <article id="content"></article>
    <div class="quiz-box" id="quizBox">
        <div class="question" id="question"></div>
        <div class="options" id="options"></div>
        <div class="explanation" id="explanation"></div>
        <button class="next-btn" onclick="nextQuestion()" id="nextBtn" style="display:none;">Question suivante</button>
    </div>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const file = urlParams.get('file');
        fetch(`${file}`).then(r=>r.json()).then(data => {
            document.getElementById('content').innerHTML = data.content; // Nettoyage HTML dÃ©jÃ  fait par process.py
            let currentQ = 0;
            const quizBox = document.getElementById('quizBox');
            
            // DÃ©clenche quiz Ã  la fin de lecture (scroll ou timeout)
            setTimeout(() => quizBox.classList.add('active'), 5000); // Simule fin lecture
            
            function showQuestion() {
                const q = data.questions[currentQ];
                document.getElementById('question').textContent = q.question;
                const options = document.getElementById('options');
                options.innerHTML = '';
                q.options.forEach((opt, i) => {
                    const btn = document.createElement('div');
                    btn.className = 'option';
                    btn.textContent = opt;
                    btn.onclick = () => selectAnswer(i === q.correct);
                    options.appendChild(btn);
                });
            }
            
            function selectAnswer(isCorrect) {
                document.querySelectorAll('.option').forEach((opt, i) => {
                    opt.classList.add(i === data.questions[currentQ].correct ? 'correct' : 'wrong');
                });
                document.getElementById('explanation').textContent = data.questions[currentQ].explanation;
                document.getElementById('explanation').style.display = 'block';
                document.getElementById('nextBtn').style.display = 'block';
            }
            
            function nextQuestion() {
                currentQ++;
                if (currentQ < data.questions.length) {
                    showQuestion();
                    document.getElementById('nextBtn').style.display = 'none';
                    document.getElementById('explanation').style.display = 'none';
                } else {
                    quizBox.innerHTML = '<h2>Quiz terminÃ© ! ðŸŽ‰</h2><p>Reviens demain pour plus.</p>';
                }
            }
            
            showQuestion();
        });
    </script>
</body>
</html>
